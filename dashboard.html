<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <title>Shiprocket Courier Admin Dashboard</title>

  <style>
    * {

      margin: 0;

      padding: 0;

      box-sizing: border-box;

      font-family: "Segoe UI", sans-serif;

    }

    body {

      background: #f5f7fb;

      display: flex;

    }

    /* Sidebar */

    .sidebar {

      width: 300px;

      height: 100vh;

      background: linear-gradient(to bottom, #0f172a, #1e293b);

      color: white;

      padding: 25px;

      padding-top: 43px;

      position: fixed;

      top: 0;

      left: 0;

    }

    .sidebar h2 {

      font-size: 22px;

      margin-bottom: 40px;

      font-weight: bold;

      display: flex;

      align-items: center;

      gap: 8px;

    }

    .menu a {

      display: flex;

      align-items: center;

      gap: 10px;

      padding: 12px;

      margin-bottom: 10px;

      border-radius: 10px;

      color: white;

      text-decoration: none;

      font-size: 16px;

      transition: 0.3s;

    }

    .menu a:hover,

    .menu a.active {

      background: rgba(255, 255, 255, 0.15);

    }

    /* Main Content */

    .main {

      margin-left: 300px;

      width: 100%;

      padding: 25px;

    }

    /* Topbar */

    .topbar {

      display: flex;

      justify-content: space-between;

      align-items: center;

      background: white;

      padding: 15px 25px;

      border-radius: 15px;

      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);

      margin-bottom: 25px;

    }

    .topbar h1 {

      font-size: 22px;

      font-weight: 700;

    }

    .profile {

      font-size: 15px;

      color: gray;

    }

    /* Cards */

    .cards {

      display: grid;

      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

      gap: 20px;

      margin-bottom: 30px;

    }

    .card {

      padding: 20px;

      border-radius: 18px;

      color: white;

      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);

      position: relative;

      overflow: hidden;

    }

    .card h3 {

      font-size: 16px;

      font-weight: 500;

    }

    .card p {

      font-size: 32px;

      font-weight: bold;

      margin-top: 12px;

    }

    .card::after {

      content: "";

      position: absolute;

      width: 120px;

      height: 120px;

      background: rgba(255, 255, 255, 0.2);

      top: -40px;

      right: -40px;

      border-radius: 50%;

    }

    .blue {

      background: linear-gradient(to right, #2563eb, #3b82f6);

    }

    .orange {

      background: linear-gradient(to right, #f97316, #fb923c);

    }

    .green {

      background: linear-gradient(to right, #16a34a, #22c55e);

    }

    /* Table Section */

    .table-box {

      background: white;

      padding: 20px;

      border-radius: 18px;

      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);

    }

    .table-box h2 {

      font-size: 18px;

      margin-bottom: 15px;

      font-weight: 700;

      display: flex;

      align-items: center;

      gap: 8px;

    }

    table {

      width: 100%;

      border-collapse: collapse;

    }

    th {

      text-align: left;

      padding: 12px;

      background: #f1f5f9;

      color: #334155;

      font-size: 15px;

    }

    td {

      padding: 12px;

      border-bottom: 1px solid #e2e8f0;

      font-size: 15px;

    }

    tr:hover {

      background: #f9fafb;

    }

    /* Status */

    .status {

      padding: 6px 14px;

      border-radius: 10px;

      font-size: 13px;

      font-weight: bold;

      display: inline-block;

    }

    .pending {

      background: #fde68a;

      color: #92400e;

    }

    .delivered {

      background: #bbf7d0;

      color: #166534;

    }

    /* Button */

    .btn {

      padding: 8px 14px;

      border: none;

      border-radius: 10px;

      background: #2563eb;

      color: white;

      cursor: pointer;

      font-size: 14px;

      transition: 0.3s;

    }

    .btn:hover {

      background: #1d4ed8;

    }
  </style>

</head>

<body>

  <!-- Sidebar -->

  <div class="sidebar">

    <h2>üöö Courier Admin</h2>

    <div class="menu">

      <a href="dashboard.html" class="active">üìä Dashboard</a>

      <a href="add-shipment.html">üìë Add Shipment</a>

      <a href="shipments.html">üì¶ View Shipments</a>

      <a href="customers.html">üë§ Customers</a>

      <a href="#" onclick="logout()">üö™ Logout</a>

    </div>

  </div>

  <!-- Main -->

  <div class="main">

    <!-- Topbar -->

    <div class="topbar">

      <h1>Admin Dashboard</h1>

      <div class="profile">Welcome, Admin üëã</div>

    </div>

    <!-- Cards -->

    <div class="cards">

      <div class="card blue">

        <h3>Total Shipments</h3>

        <p id="totalShipments">0</p>

      </div>

      <div class="card orange">

        <h3>Pending Orders</h3>

        <p id="pendingOrders">0</p>

      </div>

      <div class="card green">

        <h3>Delivered Orders</h3>

        <p id="deliveredOrders">0</p>

      </div>

    </div>

    <!-- Table -->

    <div class="table-box">

      <h2>üì¶ Recent Shipments</h2>

      <table>

        <thead>

          <tr>

            <th>Waybill</th>

            <th>Pickup</th>

            <th>Delivery</th>

            <th>Status</th>

          </tr>

        </thead>

        <tbody id="shipmentTable">

          <tr>
            <td colspan="4">Loading...</td>
          </tr>

        </tbody>

      </table>

    </div>

  </div>

  <script>

    const BACKEND_URL = "https://nxtship-backend.onrender.com";

    // ‚úÖ Check Login
    const token = localStorage.getItem("adminToken");

    if (!token) {
      alert("Please login first!");
      window.location.href = "login.html";
    }

    // ‚úÖ Load Dashboard Data
    async function loadDashboard() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/shipment/all`, {
          method: "GET",
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const data = await res.json();

        if (!data.success) {
          alert("Failed to load shipments ‚ùå");
          return;
        }

        const shipments = data.shipments;

        // ‚úÖ Counts
        document.getElementById("totalShipments").innerText =
          shipments.length;

        const pending = shipments.filter(
          (s) => s.status !== "Delivered"
        ).length;

        const delivered = shipments.filter(
          (s) => s.status === "Delivered"
        ).length;

        document.getElementById("pendingOrders").innerText = pending;
        document.getElementById("deliveredOrders").innerText = delivered;

        // ‚úÖ Table
        const table = document.getElementById("shipmentTable");
        table.innerHTML = "";

        shipments.slice(0, 8).forEach((s) => {
          table.innerHTML += `
        <tr>
          <td>${s.waybill || "Not Assigned"}</td>
          <td>${s.pickupCity || "N/A"}</td>
          <td>${s.deliveryCity || "N/A"}</td>
          <td>
            <span class="status ${s.status === "Delivered" ? "delivered" : "pending"
            }">
              ${s.status || "Pending"}
            </span>
          </td>
        </tr>
      `;
        });
      } catch (err) {
        console.error("Dashboard Error:", err);
        alert("Server Error ‚ùå Dashboard not reachable");
      }
    }

    // ‚úÖ Run
    loadDashboard();

    // ‚úÖ Logout
    function logout() {
      localStorage.removeItem("adminToken");
      window.location.href = "login.html";
    }

  </script>

</body>

</html>